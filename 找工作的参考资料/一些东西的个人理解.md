#### hyperloglog的个人理解

`HyperLogLog`，下面简称为`HLL`，它是 `LogLog` 算法的升级版，作用是能够提供不精确的去重计数。存在以下的特点：

- 代码实现较难。
- 能够使用极少的内存来统计巨量的数据，在 `Redis` 中实现的 `HyperLogLog`，**只需要`12K`内存就能统计`2^64`个数据。**
- 计数存在一定的误差，误差率整体较低。**标准误差为 0.81%** 。
- 误差可以被设置`辅助计算因子`进行降低。

> 伯努利试验

硬币拥有正反两面，一次的上抛至落下，最终出现正反面的概率都是50%。假设一直抛硬币，直到它出现正面为止，我们记录为一次完整的试验，间中可能抛了一次就出现了正面，也可能抛了4次才出现正面。无论抛了多少次，只要出现了正面，就记录为一次试验。这个试验就是`伯努利试验`。

对于这`n`次`伯努利试验`中，必然会有一个最大的抛掷次数`k`，例如抛了12次才出现正面，那么称这个为`k_max`，代表抛了最多的次数。

我们就可以利用k_max 来估算n的值。数学家们做了很多优化（具体的我不懂），最后我们只要知道可以用k_max来估算n的结果。



> redis中的hll

- 先是对元素进行hash-**- 64位**的比特串，我们可以取出部分比特串，认为第一次出现1的情况就是硬币出现正面的情况。

  - 那么如果根据这部分比特串，每次往里面插入数据的时候，记录一下最大的k_max也就是第一次出现1的最大的偏移位置

- 分桶，分桶就是分多少轮。Redis使用**16384**个桶，占了14个字节数

- 于是剩下的比特串（64-14=50位）这个需要用来观察获得k_max，k_max最大为50，那么就能用6比特位存储，2^6  = 64。每个桶里面都需要6bit来保存

- 所以hll的内存需求为：(16384*6)/8/1024 = 12kb，也即一个hll只需要12kb就能进行统计

  

  
