##王道课程笔记

## 操作系统

### 1、操作系统的概念

#### 1.1定义

**操作系统**（Operating System，OS）是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的**系统软件**。

#### 1.2 功能和目标

系统结构:操作系统处于中间的，它的功能就是对用户、对软件、对硬件

![image-20210608210747176](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210608210747.png)

![image-20210608210910407](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210608210910.png)

> 作为系统资源的管理者(上下两侧)

进程是一个程序的执行过程，执行前需要将该程序放到内存中，才能被cpu处理。

**提供的功能**：

- 文件管理
- 存储器管理(内存管理)
- 处理机管理
- 设备管理

![image-20210330201205120](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210330201205.png)

**目标**：资源的管理是安全、高效的

> 做为用户和计算机硬件之间的接口

**提供的功能**:

- 命令接口(允许用户直接使用)
  - 联机命令接口(用户说一句，系统做一句)  `cmd输入命令`
  - 脱机命令接口(又叫批处理命令接口)(用户说一堆，系统做一堆)  `批处理文件，脚本`，也叫批处理命令接口
- 程序接口
  - .dll文件。调用这个文件(**系统调用**，又叫广义指令)，实现创建窗口的功能。只能通过程序间接使用
- GUI

**目标**：方便用户使用

> 作为最接近硬件的层次

**提供的功能和目标**：实现对硬件机器的扩展

![image-20210330201939437](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210330201939.png)

---



#### 1.3 操作系统的四个特征

并发、共享、虚拟、异步

> 并发

**并发**:指两个或多个事件在**同一时间间隔**内发生。这些事件宏观上是同时发生的，但微观上是交替发生的。

易混概念――**并行**:指两个或多个事件在**同一时刻**同时发生。

![image-20210330202401916](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210330202402.png)

> 共享

资源共享：指系统中的资源可供内存中**多个并发执行的进程**共同使用

两种资源共享方式：

- 互斥共享方式: 一个时间段只允许一个进程访问该资源   (**摄像头分配**)
- 同时共享方式:允许一个时间段内由多个进程“同时”对它们进行访问  (**两个软件都传输文件**)

同时指的是宏观上的。微观上这些进程可能是交替的对该资源进行访问。

![image-20210330203132290](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210330203132.png)

> 虚拟

虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，逻辑上对应物是用户感受到的。

![image-20210330203327398](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210330203327.png)

![image-20210330203412827](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210330203413.png)



虚拟技术：

- 空分复用技术(例子1)
- 时分复用技术(例子2)



==没有并发就没有虚拟==

![image-20210608212759797](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210608212759.png)

> 异步

指的是：在多道程序环境下，允许多个程序并发执行，但是由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进。

![image-20210608213048177](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210608213048.png)





没有并发和共享，就谈不上虚拟和异步，因此**并发和共享是操作系统的两个最基本的特征**

#### 1.4操作系统的发展和分类

![image-20210331161918417](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331161918.png)

> 手工操作阶段

![image-20210331162050426](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162050.png)

**缺点**：用户独占全机，人机速度矛盾导致资源利用率低。  人手动安装纸带速度慢，处理机速度快，就需要空闲等待。

> 批处理-单道批处理系统

![image-20210331162245714](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162245.png)

**优点**：缓解了一定程度的人机速度矛盾，资源利用率提升。

**缺点**：内存中只有一道程序运行。CPU大量时间在等待状态，资源利用率低

> 批处理-多道批处理系统

![image-20210331162445029](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162445.png)

**优点**：多道程序并发执行，共享计算机资源。利用率大幅提升

**缺点**：没有人机交互功能。

![image-20210331162636440](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162636.png)

单道批需要9s。

> 分时操作系统

![image-20210331162755753](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162755.png)

**在每个时间片内，被分到的用户能够被即时的响应**

**优点**：解决了人机交互问题。

**缺点**：不能优先处理一些紧急任务。

> 实时操作系统

![image-20210331162937105](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162937.png)

优点：能够响应一些紧急任务。 及时性和可靠性



> 其他几种操作系统

![image-20210331162959217](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331162959.png)

#### 1.5、操作系统的运行机制和体系结构



![image-20210331163109178](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331163109.png)

##### 1、运行机制

> 两种指令

指令就是处理器(CPU)能识别、执行的最基本命令

**两种指令**：

- 特权指令(有很高的权限)
  - 不允许用户程序使用
  - 如内存清零指令
- 非特权指令(**用起来没什么危害**)
  - 普通的运算指令

> CPU怎么判断是否可以执行特权指令？

两种处理器状态：(**程序状态字寄存器(PSW)**中的**某标志位**来标识当前处理器处于什么状态。**0是用户态，1是核心态**)

- **用户态**(目态)：处于这个状态，CPU只能执行**非特权指令**
- **核心态**(管态)：处于这个状态，CPU可以执行**特权指令和非特权指令**

> 两种程序

- 内核程序：操作系统的内核程序是系统的管理者，既可以执行特权指令，也可以执行非特权指令。运行在**核心态**
- 应用程序：普通应用程序只能执行非特权指令，运行在用户态。

##### 2、操作系统的内核

![image-20210331164219265](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331164219.png)





**内核功能**：

- 时钟管理
  - 计时功能
- 中断处理
  - 负责实现中断机制
- 原语
  - 一种特殊的程序
  - 最接近硬件的部分
  - 具有原子性，也就是要么都完成，要么都不完成
  - 运行时间短、调用频繁
- 系统资源进行管理的功能(有的操作系统不把这部分归到内核功能)
  - 进程管理
  - 存储器管理
  - 设备管理

##### 3.操作系统的体系结构

不同的操作系统划分是不同的：分为大内核和微内核。划分依据：**有没有把对系统资源进行管理的功能放进内核**。如果放进去了就东西很多，所以是大内核。反之就是微内核

![image-20210331164502393](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331164502.png)

大内核：

- 优点：高性能
- 缺点：代码庞大，结构混乱，不好维护

微内核：

- 优点：内核功能少，结构清晰，方便维护
- 缺点：需要频繁的在核心态和用户态切换(系统资源管理不包含在里面，需要切换到核心态)，性能低

![image-20210609204308049](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210609204308.png)

#### 1.6、中断和异常

![image-20210331165241425](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331165241.png)

> 中断机制的诞生

最开始，都是串行执行程序。效率低。引入中断机制，实现了多道程序 并发执行

**本质**：发生**中断就意味着需要操作系统介入**，开展管理工作

**例子**：

进程1执行一段时间后，CPU收到计时部件发出的**中断信号**，CPU切换到**核心态**对中断进行处理，将CPU的使用权限交给操作系统，操作系统内核就负责对中断信号进行处理，操作系统收到的信号是进程1的时间已到，需要换进程2. 操作系统让进程2执行。执行完中断操作后，操作系统就切换回用户态，并将CPU的使用权限归还。

进程2执行一段时间后，想使用IO设备。是控制硬件，进程没有权限。于是进程2发出**系统调用(内中断信号**)。CPU切换到**核心态**，....操作系统接管，让IO处理，在处理过程中，因为需要等待IO执行，进程2暂时结束，切换到进程3。IO设备也并行的运行。这些操作完成后，CPU权限还给CPU，切换到用户态。如果IO执行完毕，就发出中断信号，CPU就又知道让操作系统接管了。然后再核心态里面，又切换回进程2进行后续的操作。

> 中断的概念和作用

**中断**是用户态切换到核心态的唯一途径。

![image-20210331165832683](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331165832.png)

> 中断的分类

中断：

- 内中断(也叫异常、例外、陷入)
  - 自愿中断-指令中断
  - 强迫中断
    - 硬件故障
    - 软件中断
- 外中断(中断)
  - 外设请求
  - 人工干预

![image-20210331192726504](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331192726.png)

另一种分类：

![image-20210331192819487](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331192819.png)

> 外中断处理过程

![image-20210331192958235](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331192958.png)

#### 1.7 、系统调用

![image-20210331193121141](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331193121.png)

##### 1、什么是系统调用？有什么作用

![image-20210331193217364](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331193217.png)

> 作用

打印机的例子：A打印，没打印完，B也点开始打印。如果各个进程可以随意的使用打印机，会发生什么

解决办法:操作系统提供“系统调用”功能，用户进程想要使用打印机这种共享资源，只能通过系统调用向操作系统发生请求。操作系统会对各个请求进行协调管理。



![image-20210331193655159](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331193655.png)

##### 2、系统调用和库函数的区别

![image-20210331193913128](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331193913.png)

有的库函数是不涉及系统调用的。

##### 3、系统调用背后的过程

![image-20210331194424792](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331194424.png)



**核心态基本可以使用所有的指令，除了陷入指令以外**

linux里面的系统调用号(陷入指令 int x，**这个x就是后面的调用号**)

![image-20210331194221132](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331194221.png)

### 2、进程

#### 2.1、进程

##### 1.进程概念

![image-20210331202440900](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331202441.png)

> 定义

![image-20210610203343557](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610203343.png)

![image-20210331202747456](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331202747.png)





![image-20210331202859080](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331202859.png)

程序段、数据段、PCB组成了进程实体(进程映像)。创建进程，就是创建进程的PCB。撤销进程就是撤销进程的PCB。 

**PCB是进程存在的唯一标志。**



- 进程是程序的一次执行过程
- **进程是动态性的**
- 进程是进程实体的运行过程，**是系统进行资源分配和调度的一个独立单位**
- 进程实体是静态的，进程是动态的

> 进程的组成

![image-20210331203020979](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331203021.png)



![image-20210331203120853](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331203120.png)

![image-20210331203228447](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331203228.png)

> 进程的组织

**对进程的管理**

多个进程之间的组织方式问题：

![image-20210331203316709](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331203316.png)

![image-20210331203430282](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331203430.png)

![image-20210331203447676](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331203447.png)

> 进程的特征

![image-20210331204123933](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210331204124.png)

#### 2.2、进程的状态和转换

> 总览

![image-20210610204324319](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610204324.png)

##### 1.状态

> 三种基本状态

![image-20210610204518150](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610204518.png)

> 另外两种状态

创建态

出现问题，进程无法继续执行。就需要撤销进程。操作系统完成分配给进程的资源回收，撤销分配的内存区域、删除PCB

![image-20210610204802183](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610204802.png)

##### 2.状态的转换

![image-20210610205048273](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610205048.png)

![image-20210610205107423](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610205107.png)

#### 2.3 进程控制

![image-20210610211203929](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610211204.png)

##### 1.进程控制

![image-20210610211328356](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610211328.png)

> 如何实现

![image-20210610211803836](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610211804.png)



用原语实现进程控制，原语具有原子性。 使用关中断和开中断指令实现的原子性。(跟锁一样)

![image-20210610211928875](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610211929.png)

> 原语

![image-20210610213135004](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610213135.png)

==创建原语==

![image-20210610213141275](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610213141.png)

==撤销原语==

![image-20210610213251333](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610213251.png)

![image-20210610213408021](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610213408.png)

![image-20210610213444692](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610213444.png)

#### 2.4进程通信

![image-20210610213543909](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610213543.png)

##### 1.什么是进程通信

![image-20210610214134635](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214134.png)



> 共享存储

![image-20210610214345886](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214346.png)

> 管道通信  -- 放的是文件

![image-20210610214647349](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214647.png)

> 消息传递

![image-20210610214802573](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214802.png)



![image-20210610214851604](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214851.png)







![image-20210610214827610](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214827.png)

#### 2.5 线程、多线程

![image-20210610214955098](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610214955.png)

##### 1.线程

![image-20210610215215842](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215216.png)

![image-20210610215305754](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215305.png)

> 变化

![image-20210610215453889](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215454.png)

> 线程属性

![image-20210610215645697](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215645.png)

> 实现方式

用户级线程，内核级线程

![image-20210610215748124](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215748.png)

![image-20210610215825234](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215825.png)



![image-20210610215913385](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610215913.png)

##### 2.多线程模型

![image-20210610220022324](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610220022.png)

![image-20210610220124250](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610220124.png)



![image-20210610220202060](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210610220202.png)

### 3、调度

#### 1.处理机调度

![image-20210614212725404](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614212725.png)

##### 1.基本概念

当有一堆任务要处理，资源有限，需要按照某种规则来决定处理这些任务的顺序，这就是调度

![image-20210614213041062](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614213041.png)

##### 2.调度的三个层次

> 高级调度

![image-20210614213225894](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614213226.png)



> 中级调度

![image-20210614213456614](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614213456.png)

> 低级调度

![image-20210614214008407](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214008.png)



> 总结

![image-20210614214055686](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214055.png)

##### 3.补充知识

![image-20210614213754018](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614213754.png)

![image-20210614213921641](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614213921.png)

#### 2.进程调度

![image-20210614214245420](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214245.png)

##### 1.时机

![image-20210614214426541](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214426.png)



![image-20210614214637588](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214637.png) 



![image-20210614214741132](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214741.png)

![image-20210614214805437](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214805.png)





##### 2.进程调度的方式

![image-20210614214955021](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614214955.png)

##### 3.进程的切换和过程

![image-20210614215205143](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215205.png)

#### 3.调度算法的评价指标

![image-20210614215232390](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215232.png)



##### 1.CPU利用率

![image-20210614215349454](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215349.png)

##### 2.系统吞吐量

![image-20210614215423137](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215423.png)

##### 3.周转时间

![image-20210614215553294](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215553.png)

 周转时间(等待加运行) 和   运行时间的比例

![image-20210614215707358](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215707.png)

##### 4.等待时间

![image-20210614215911422](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215911.png)

##### 5.响应时间

![image-20210614215939203](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614215939.png)

#### 4.调度算法 - 批处理

![image-20210614220055737](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614220055.png)

##### 1.先来先服务 （FCFS，First com first serve）

![image-20210614220934307](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614220934.png)

##### 2.短作业优先(SJF，Shortest job first)

两种- 抢占和非抢占

![image-20210614221452018](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614221452.png)

![image-20210614221754851](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614221755.png)

##### 3.高响应比优先(HRRN,Highest Response Ratio Next)

![image-20210614222309911](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614222310.png)



##### 4.总结

![image-20210614222330263](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210614222330.png)

#### 5、调度算法-交互式系统

![image-20210615201314266](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615201314.png)

##### 1. 时间片轮转(RR,Round-Robin)

![image-20210615202616656](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615202616.png)





![](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615202344.png)

![](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615202448.png)

![image-20210615202519595](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615202519.png)

##### 2.优先级调度算法

![image-20210615203327110](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615203327.png)





![image-20210615203245403](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615203245.png)

##### 3.多级反馈队列调度算法

![image-20210615203413823](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615203413.png)



![image-20210615205450679](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615205450.png)

![image-20210615203723206](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615203723.png)





##### 4.总结

![image-20210615210220240](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615210220.png)



### 4、进程同步互斥



![image-20210615211227643](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615211227.png)

#### 1.进程同步和互斥

> 进程同步

![image-20210615211438200](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615211438.png)



![image-20210615211525326](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615211525.png)

> 进程互斥

![image-20210615211653392](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615211653.png)



![image-20210615211836176](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615211836.png)



![image-20210615211945078](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210615211945.png)

#### 2.进程互斥的软件实现

##### 1.单标志法

![image-20210707151731166](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707151731.png)

如果p0不访问，p1就不能访问。

##### 2.双标志先检查法

![image-20210707152018776](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707152018.png)

##### 3.双标志后检查法

![image-20210707152142339](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707152142.png)

##### 4、peterson算法

![image-20210707152500668](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707152500.png)

![image-20210707152544610](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707152544.png)

#### 3.硬件实现

##### 1.中断屏蔽方法

![image-20210707152820362](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707152820.png)

这个中断指令只对一个处理机有效，另外一个处理机访问，就阻挡不了

##### 2.TestAndSet指令

![image-20210707153128773](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707153129.png)

上述代码只是描述过程，实践上是用硬件实现的

##### 3.Swap指令

![image-20210707153245574](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707153245.png)

逻辑和TeseAndSetLock 差不多

#### 4.信号量机制

![image-20210707153404072](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707153404.png)



![image-20210707153615790](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707153616.png)



##### 1整形信号量

![image-20210707153929020](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707153929.png)

##### 2.记录型信号量

![image-20210707154301291](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707154301.png)





![image-20210707154649260](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707154649.png)

这里处理机先给等待队列的队头.



![](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707154826.png)

##### 3.小结

![image-20210707154848947](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707154849.png)

#### 5、信号量机制实现进程互斥、同步、前驱关系

##### 1.互斥

![image-20210707155346940](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707155347.png)

##### 2.同步

![image-20210707155446664](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707155446.png)



> 实现  ==这里的S=0，巧妙==

![image-20210707155713178](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707155713.png)

##### 3.前驱关系

![image-20210707155930135](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707155930.png)

#### 6、生产者消费者

> 过程

![image-20210707160231443](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210707160231.png)

必须互斥访问，不然两个 生产者就可能覆盖之前的数据

> 如何实现上述过程



![image-20210708155620192](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708155620.png)



![image-20210708155723370](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708155723.png)



![image-20210708155956299](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708155956.png)

#### 7、多生产者多消费者

这里的多是指的多类

![image-20210708160308211](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708160308.png)

> 实现

![image-20210708160805914](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708160806.png)

先看同步关系，再对临界资源前后加上pv进行互斥



> 删去互斥信号

![image-20210708161005562](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708161005.png)

![image-20210708161105265](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708161105.png)



#### 8、吸烟者

![image-20210708161505939](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708161506.png)

![image-20210708161758351](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708161758.png)

![image-20210708161948984](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708161949.png)

#### 9.哲学家进餐

![image-20210708164819677](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708164819.png)

![image-20210708164838244](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708164838.png)

死锁了，第一种方式





![image-20210708164901068](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708164901.png)

![image-20210708164932177](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708164932.png)

第三种的实现代码：

会有一个问题

![image-20210708165030500](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708165030.png)





![image-20210708165115608](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708165115.png)

#### 10、管程

![image-20210708165209479](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708165209.png)

##### 1.为什么引入管程

![image-20210708165248189](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708165248.png)

##### 2.管程定义和特征

![image-20210708165523217](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708165523.png)



![image-20210708165702023](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708165702.png)

==互斥由编译器提供==   同步在过程中实现了



![image-20210708170133524](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170133.png)



![image-20210708170207631](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170207.png)

##### 回顾

![image-20210708170237091](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170237.png)

### 5、死锁

#### 1.死锁的概念

![image-20210708170337167](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170337.png)



##### 1.

![image-20210708170703007](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170703.png)

##### 2.死锁产生的必要条件

![image-20210708170902699](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170902.png)

![image-20210708170929345](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708170929.png)

##### 3.

![image-20210708171042237](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708171042.png)

##### 4.

![image-20210708171114506](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210708171114.png)

#### 2.破坏死锁的条件

> 破坏互斥

![image-20210711202653447](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711202653.png)



> 破坏不剥夺条件

![image-20210711202904795](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711202904.png)

> 破坏请求和保持条件

![image-20210711203052407](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711203052.png)

一直有A、B进来，C类就会饥饿

> 破坏循环等待

![image-20210711203405467](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711203405.png)

> 总结

![image-20210711203439981](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711203440.png)

#### 3.避免死锁

![image-20210711203517263](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711203517.png)

##### 1.安全序列

![image-20210711203853411](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711203853.png)

#### 4.银行家算法

![image-20210711204015267](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711204015.png)

![image-20210711204132366](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711204132.png)



不满足的



![image-20210711204233302](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711204233.png)

> 代码实现

![image-20210711204440544](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711204440.png)

这里有资源的请求 request，所以先用我们有的序列减去请求的序列（暂时性的改变），然后改变已分配的和Need矩阵的数据，再用之前的判断算法，从头开始一直到最后进行判断，如果能够找到一个安全序列，就正式分配。如果找不到，就恢复相应数据，让进程阻塞等待

#### 5.死锁的检测和解除

![image-20210711204853701](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711204853.png)

> 检测

![image-20210711205443986](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711205444.png)

![image-20210711205639493](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711205639.png)

> 解除

![image-20210711205749860](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210711205750.png)

### 6、内存

#### 1.基础知识

![image-20210712095622257](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712095622.png)

> 什么是内存？有何作用

内存是用于存放数据的硬件。程序执行前需要先放到内存中才能被CPU处理

![image-20210712095842132](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712095842.png)



![image-20210712100355084](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712100355.png)

![image-20210712100428433](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712100428.png)

> 逻辑地址  -  物理地址

![image-20210712100732581](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712100732.png)



![image-20210712100837399](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712100837.png)



如果从0开始装入就是对的地址，但是如果从100就是错的，下图有解决办法

![image-20210712101016307](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101016.png)

> 装入的三种方式

![image-20210712101134613](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101134.png)

![image-20210712101252114](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101252.png)



![image-20210712101421221](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101421.png)

> 链接的三种方式

![image-20210712101517781](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101517.png)

![image-20210712101533771](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101533.png)

#### 2.内存管理

![image-20210712101647189](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101647.png)

![image-20210712101729288](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101729.png)

![image-20210712101745418](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101745.png)

![image-20210712101901606](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712101901.png)

![image-20210712102021002](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712102021.png)

![image-20210712102119206](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210712102119.png)

#### 3.覆盖与交换

![image-20210713194153130](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713194153.png)

> 覆盖技术

![image-20210713194300351](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713194300.png)



程序存在调用结构。B和C可以不同时调用，DEF同理

![image-20210713194515629](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713194515.png)



> 交换技术

内存不够了，某些进程先出去，然后PCB留在内存，进入挂起队列，之后内存不紧张了，就又回来

![image-20210713194701933](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713194702.png)



![image-20210713195022033](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713195022.png)

(PCB还是在内存里)





![image-20210713195059110](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713195059.png)

#### 4、连续分配管理方式

![image-20210713195215152](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713195215.png)

> 单一连续分配

![image-20210713195423815](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713195423.png)

> 固定分区分配

![image-20210713201838619](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713201838.png)



![image-20210713202014127](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202014.png)

> 动态分区分配

![image-20210713202205052](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202205.png)



![image-20210713202301437](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202301.png)



![image-20210713202349668](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202349.png)



**分配**

![image-20210713202439554](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202439.png)

![image-20210713202502068](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202502.png)

回收



![image-20210713202537667](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202537.png)

![image-20210713202556483](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202556.png)

![image-20210713202624387](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202624.png)



![image-20210713202717128](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202717.png)







![image-20210713202916936](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202917.png)

移动空间的位置，就能凑出20M内存

![image-20210713202936273](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713202936.png)

#### 5、动态分区分配算法

![image-20210713203055098](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713203055.png)



> 首次适应

![image-20210713203224636](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713203224.png)

15M进来，发现第一个满足，分配内存，更新表 20->5

> 最佳适应算法



![image-20210713203526216](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713203526.png)

> 最坏适应算法

![image-20210713203728754](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713203728.png)

> 邻近适应算法

![image-20210713204056026](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713204056.png)



> 总结

![image-20210713204104825](https://xy-picgo.oss-cn-shenzhen.aliyuncs.com/20210713204105.png)